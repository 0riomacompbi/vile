#!/usr/bin/env node
require("shelljs/global")

rm("-r", "coverage")
rm("-r", ".nyc_output")

mkdir("coverage")

exec(
  "nyc -r json --report-dir coverage/non-system bin/test-non-system",
  function(code) {
    code !== 0 && exit(code)

    exec(
      "cross-env TEST_COV=1 npm run test-system",
      function(code) {
        code !== 0 && exit(code)

        exec(
          "istanbul report --dir coverage lcov text json",
          function(code) { code !== 0 && exit(code) })
      })
  })
