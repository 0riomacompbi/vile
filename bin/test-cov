#!/usr/bin/env node
require("shelljs/global")

rm("-r", "coverage")
rm("-r", ".nyc_output")

mkdir("coverage")

exec(
  "npm run -s test-non-system-cov",
  function(code) {
    code !== 0 && exit(code)

    exec(
      "npm run -s test-system-cov",
      function(code) {
        code !== 0 && exit(code)

        exec(
          "istanbul report --dir coverage lcov text json",
          function(code) {
            code !== 0 && exit(code)

            console.log("See: coverage/lcov-report/index.html")
          })
      })
  })
